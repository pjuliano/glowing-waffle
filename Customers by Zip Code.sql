WITH delzips AS (
    SELECT              customer_id,
                        cust_ord_customer_api.get_salesman_code(customer_id) AS current_salesman
    FROM                customer_info
    WHERE               kd_get_corporate_form(customer_id) = 'DOMDIR' AND
                        customer_info_address_api.get_zip_code(
                            customer_id,customer_info_address_api.get_default_address(
                                customer_id,'Delivery'
                            )
                        ) IN (
'49744',
'49745',
'49746',
'49747',
'49748',
'49749',
'49751',
'49752',
'49753',
'49755',
'49756',
'49757',
'49759',
'49760',
'49762',
'49764',
'49765',
'49766',
'49768',
'49769',
'49770',
'49774',
'49775',
'49776',
'49777',
'49779',
'49780',
'49781',
'49782',
'49783',
'49788',
'49791',
'49793',
'49795',
'49796',
'49797',
'49799',
'49801',
'49805',
'49806',
'49807',
'49808',
'49812',
'49814',
'49815',
'49816',
'49817',
'49818',
'49820',
'49821',
'49822',
'49825',
'49827',
'49829',
'49831',
'49833',
'49834',
'49835',
'49836',
'49837',
'49838',
'49839',
'49840',
'49841',
'49847',
'49849',
'49853',
'49854',
'49855',
'49858',
'49861',
'49862',
'49864',
'49866',
'49868',
'49870',
'49871',
'49872',
'49873',
'49874',
'49877',
'49878',
'49879',
'49880',
'49881',
'49883',
'49884',
'49885',
'49887',
'49891',
'49892',
'49893',
'49895',
'49896',
'49901',
'49903',
'49905',
'49908',
'49910',
'49911',
'49912',
'49913',
'49916',
'49917',
'49918',
'49919',
'49920',
'49921',
'49922',
'49925',
'49929',
'49930',
'49931',
'49934',
'49935',
'49938',
'49945',
'49946',
'49947',
'49948',
'49950',
'49952',
'49953',
'49955',
'49958',
'49959',
'49960',
'49961',
'49962',
'49963',
'49965',
'49967',
'49968',
'49969',
'49970',
'49971'
                        )),
Sales AS (
SELECT                  customer_no,
                        SUM(CASE WHEN part_product_code = 'REGEN' THEN allamounts ELSE 0 END) AS REGEN,
                        SUM(CASE WHEN part_product_code != 'REGEN' THEN allamounts ELSE 0 END) AS IMPL
FROM                    kd_sales_data_request kdsd
                            WHERE
                                Extract(Year From kdsd.Invoicedate)= Extract(Year From Sysdate)-1 And
                                kdsd.Charge_Type = 'Parts' And
                                kdsd.Corporate_Form = 'DOMDIR' And
                                kdsd.Catalog_No != '3DBC-22001091' And
                                ((kdsd.Order_No Not Like 'W%' And
                                  kdsd.Order_No Not Like 'X%')Or
                                 kdsd.Order_No Is Null)And
                                (kdsd.Market_Code != 'PREPOST' Or
                                 kdsd.Market_Code Is Null)And
                                kdsd.Invoice_Id != 'CR1001802096' And --20180904 Invoice is stuck not posted and cannot be deleted.
                                (kdsd.Order_No != 'C512921' Or kdsd.Order_No Is Null) --Kevin Stack's order/return that spanned years.
GROUP BY                customer_no)

Select delzips.customer_id, delzips.current_salesman, sales.regen, sales.impl From delzips left join sales on delzips.customer_id = sales.customer_no WHERE current_Salesman != '121'